# NVIDIA GPU Operator Helm values for Azure AKS
# Mixed GPU node pool configuration. See docs/gpu-configuration.md for architecture details.

# Operator settings
operator:
  runtimeClass: nvidia

# CDI disabled; this cluster uses runtimeClass-based GPU injection.
cdi:
  enabled: false

# Tolerations for GPU and spot nodes
daemonsets:
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
    - key: kubernetes.azure.com/scalesetpriority
      operator: Equal
      value: spot
      effect: NoSchedule

# Driver for H100 nodes; RTX PRO 6000 uses GRID DaemonSet (see docs/gpu-configuration.md).
# Proprietary kernel modules required for Azure vGPU.
driver:
  enabled: true
  kernelModuleType: proprietary
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
    - key: kubernetes.azure.com/scalesetpriority
      operator: Equal
      value: spot
      effect: NoSchedule

# Container toolkit
toolkit:
  enabled: true
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
    - key: kubernetes.azure.com/scalesetpriority
      operator: Equal
      value: spot
      effect: NoSchedule

# Device plugin
devicePlugin:
  enabled: true
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
    - key: kubernetes.azure.com/scalesetpriority
      operator: Equal
      value: spot
      effect: NoSchedule

# DCGM exporter for GPU metrics
dcgmExporter:
  enabled: true
  serviceMonitor:
    enabled: false  # Using PodMonitor instead
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
    - key: kubernetes.azure.com/scalesetpriority
      operator: Equal
      value: spot
      effect: NoSchedule

# MIG strategy: single required for RTX PRO 6000 vGPU (see docs/gpu-configuration.md).
mig:
  strategy: single

# MIG manager disabled; vGPU host manages MIG instances.
migManager:
  enabled: false

# GPU Feature Discovery
gfd:
  enabled: true
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
    - key: kubernetes.azure.com/scalesetpriority
      operator: Equal
      value: spot
      effect: NoSchedule

# Node Feature Discovery
node-feature-discovery:
  worker:
    tolerations:
      - key: node-role.kubernetes.io/master
        operator: Equal
        value: ""
        effect: NoSchedule
      - key: node-role.kubernetes.io/control-plane
        operator: Equal
        value: ""
        effect: NoSchedule
      - key: nvidia.com/gpu
        operator: Exists
        effect: NoSchedule
      - key: kubernetes.azure.com/scalesetpriority
        operator: Equal
        value: spot
        effect: NoSchedule

# Node status exporter
nodeStatusExporter:
  enabled: true

# Validator
validator:
  enabled: true
  tolerations:
    - key: nvidia.com/gpu
      operator: Exists
      effect: NoSchedule
    - key: kubernetes.azure.com/scalesetpriority
      operator: Equal
      value: spot
      effect: NoSchedule
