# IsaacLab Training Job Template
#
# This is a STRUCTURAL TEMPLATE used by submit-azureml-training.sh.
# Almost all values below are placeholders and will be overridden at submission time.
#
# The script is responsible for:
# - Setting code path (packaged training payload)
# - Setting environment (with correct version)
# - Setting compute target
# - Building the command with all training parameters
# - Setting all input values (Azure context, training config, etc.)
#
# This file primarily defines:
# - The job structure and schema
# - Input/output specifications
# - Environment variable mappings
# - Identity configuration
#
# To submit a job, use submit-azureml-training.sh with appropriate flags.

$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
type: command
display_name: IsaacLab Training
description: IsaacLab SKRL training job with MLflow integration and checkpoint management.
experiment_name: isaaclab-training
identity:
  type: managed_identity

# All values below are placeholders and will be overridden by submit-azureml-training.sh
# This file serves as a structural template for the job definition.
code: .
environment: azureml:isaaclab-training-env:latest
compute: azureml:cpu-cluster

inputs:
  mode: train
  checkpoint_mode: from-scratch
  headless: true
  subscription_id: placeholder
  resource_group: placeholder
  workspace_name: placeholder
  run_azure_smoke_test: false
  mlflow_token_refresh_retries: 3
  mlflow_http_request_timeout: 60

command: echo "Command will be set by submission script"

environment_variables:
  TRAINING_CHECKPOINT_OUTPUT: ${{outputs.checkpoints}}
  AZURE_SUBSCRIPTION_ID: ${{inputs.subscription_id}}
  AZURE_RESOURCE_GROUP: ${{inputs.resource_group}}
  AZUREML_WORKSPACE_NAME: ${{inputs.workspace_name}}
  RUN_AZURE_SMOKE_TEST: ${{inputs.run_azure_smoke_test}}
  MLFLOW_TRACKING_TOKEN_REFRESH_RETRIES: ${{inputs.mlflow_token_refresh_retries}}
  MLFLOW_HTTP_REQUEST_TIMEOUT: ${{inputs.mlflow_http_request_timeout}}

outputs:
  checkpoints:
    type: uri_folder
    mode: upload
